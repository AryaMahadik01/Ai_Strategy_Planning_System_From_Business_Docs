{% extends "base.html" %}
{% block content %}

<h2>Performance & Strategic KPIs</h2>

<p style="color: var(--text-muted); margin-bottom: 30px;">
    Visual performance indicators reflecting strategic readiness, growth progress, and risk exposure.
</p>

<div class="kpi-row">
    <div class="card" style="border-top: 4px solid var(--success);">
        <h4 style="color: var(--text-muted); font-size: 14px; text-transform: uppercase; letter-spacing: 0.5px;">
            Strategy Readiness
        </h4>
        <h2 style="font-size: 36px; margin: 10px 0;">{{ scores.readiness }}%</h2>
        
        {% if scores.readiness > 70 %}
            <span style="background: #dcfce7; color: #166534; padding: 4px 10px; border-radius: 20px; font-size: 12px; font-weight: 600;">
                ● Strong
            </span>
        {% else %}
            <span style="background: #fef9c3; color: #854d0e; padding: 4px 10px; border-radius: 20px; font-size: 12px; font-weight: 600;">
                ● Developing
            </span>
        {% endif %}
    </div>

    <div class="card" style="border-top: 4px solid #38bdf8;">
        <h4 style="color: var(--text-muted); font-size: 14px; text-transform: uppercase; letter-spacing: 0.5px;">
            Business Maturity
        </h4>
        <h2 style="font-size: 36px; margin: 10px 0;">{{ scores.maturity }}%</h2>
        <span style="background: #e0f2fe; color: #0369a1; padding: 4px 10px; border-radius: 20px; font-size: 12px; font-weight: 600;">
            ● Growing
        </span>
    </div>

    <div class="card" style="border-top: 4px solid var(--warning);">
        <h4 style="color: var(--text-muted); font-size: 14px; text-transform: uppercase; letter-spacing: 0.5px;">
            Digital Transformation
        </h4>
        <h2 style="font-size: 36px; margin: 10px 0;">{{ scores.digital }}%</h2>
        <span style="background: #ffedd5; color: #9a3412; padding: 4px 10px; border-radius: 20px; font-size: 12px; font-weight: 600;">
            ● In Progress
        </span>
    </div>

    <div class="card" style="border-top: 4px solid var(--danger);">
        <h4 style="color: var(--text-muted); font-size: 14px; text-transform: uppercase; letter-spacing: 0.5px;">
            Risk Exposure
        </h4>
        <h2 style="font-size: 36px; margin: 10px 0;">{{ scores.risk }}%</h2>
        
        {% if scores.risk < 40 %}
            <span style="background: #dcfce7; color: #166534; padding: 4px 10px; border-radius: 20px; font-size: 12px; font-weight: 600;">
                Safe Level
            </span>
        {% else %}
            <span style="background: #fee2e2; color: #991b1b; padding: 4px 10px; border-radius: 20px; font-size: 12px; font-weight: 600;">
                Needs Attention
            </span>
        {% endif %}
    </div>
</div>

<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 24px; margin-top: 20px;">
    
    <div class="card">
        <h3>KPI Progress Overview</h3>
        <p style="color: var(--text-muted); font-size: 13px; margin-bottom: 15px;">
            Breakdown of key strategic pillars based on document analysis.
        </p>
        <canvas id="kpiChart" style="max-height: 300px;"></canvas>
    </div>

    <div class="card">
        <h3>Growth vs Risk Trend</h3>
        <p style="color: var(--text-muted); font-size: 13px; margin-bottom: 15px;">
            Projected trajectory over the next 6 months based on current strategy.
        </p>
        <canvas id="trendChart" style="max-height: 300px;"></canvas>
    </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
// KPI BAR CHART
new Chart(document.getElementById("kpiChart"), {
    type: "bar",
    data: {
        labels: {{ kpi_labels | safe }},
        datasets: [{
            label: "KPI Achievement (%)",
            data: {{ kpi_values | safe }},
            backgroundColor: [
                'rgba(79, 70, 229, 0.7)',  // Indigo
                'rgba(16, 185, 129, 0.7)', // Green
                'rgba(245, 158, 11, 0.7)', // Orange
                'rgba(239, 68, 68, 0.7)',  // Red
                'rgba(56, 189, 248, 0.7)'  // Sky
            ],
            borderColor: [
                'rgb(79, 70, 229)',
                'rgb(16, 185, 129)',
                'rgb(245, 158, 11)',
                'rgb(239, 68, 68)',
                'rgb(56, 189, 248)'
            ],
            borderWidth: 1,
            borderRadius: 6
        }]
    },
    options: {
        responsive: true,
        plugins: {
            legend: { display: false }
        },
        scales: {
            y: {
                beginAtZero: true,
                max: 100,
                grid: { color: '#f1f5f9' } // Subtle grid lines
            },
            x: {
                grid: { display: false }
            }
        }
    }
});

// TREND LINE CHART
new Chart(document.getElementById("trendChart"), {
    type: "line",
    data: {
        labels: {{ trend_labels | safe }},
        datasets: [
            {
                label: "Growth Trend",
                data: {{ growth_trend | safe }},
                borderColor: '#10b981', // Green
                backgroundColor: 'rgba(16, 185, 129, 0.1)',
                tension: 0.4, // Smooth curve
                fill: true
            },
            {
                label: "Risk Trend",
                data: {{ risk_trend | safe }},
                borderColor: '#ef4444', // Red
                backgroundColor: 'rgba(239, 68, 68, 0.1)',
                tension: 0.4,
                fill: true
            }
        ]
    },
    options: {
        responsive: true,
        plugins: {
            legend: { position: 'bottom' }
        },
        scales: {
            y: {
                beginAtZero: true,
                max: 100,
                grid: { color: '#f1f5f9' }
            },
            x: {
                grid: { display: false }
            }
        }
    }
});
</script>

{% endblock %}