{% extends "base.html" %}

{% block content %}
<h2>AI Strategic Insights</h2>

{% if error %}
    <div class="card"><p>{{ error }} <a href="/user/documents">Upload a document first.</a></p></div>
{% else %}

<p style="color:#64748b">
    Analysis for: <b>{{ doc.filename }}</b>
</p>

<div class="card">
    <h3>SWOT Analysis</h3>
    <div class="kpi-row">
        <div class="card">
            <h4>Strengths</h4>
            <ul>
                {% for item in doc.swot.strengths %}
                    <li>{{ item }}</li>
                {% endfor %}
            </ul>
        </div>
        <div class="card">
            <h4>Weaknesses</h4>
            <ul>
                {% for item in doc.swot.weaknesses %}
                    <li>{{ item }}</li>
                {% endfor %}
            </ul>
        </div>
    </div>
    <div class="kpi-row">
        <div class="card">
            <h4>Opportunities</h4>
            <ul>
                {% for item in doc.swot.opportunities %}
                    <li>{{ item }}</li>
                {% endfor %}
            </ul>
        </div>
        <div class="card">
            <h4>Threats</h4>
            <ul>
                {% for item in doc.swot.threats %}
                    <li>{{ item }}</li>
                {% endfor %}
            </ul>
        </div>
    </div>
</div>

<div class="card">
    <h3>PESTLE Analysis</h3>
    <ul>
        {# Use .get() to avoid crashing if 'pestle' is missing #}
        {% for category, detail in doc.get('pestle', {}).items() %}
            <li><b>{{ category }}:</b> {{ detail }}</li>
        {% else %}
            <li><i>No PESTLE data available for this document. Upload a new document to generate this analysis.</i></li>
        {% endfor %}
    </ul>
</div>

<div class="card">
    <h3>Porterâ€™s Five Forces</h3>
    <ul>
        {# Use .get() to avoid crashing if 'porters' is missing #}
        {% for force, level in doc.get('porters', {}).items() %}
            <li><b>{{ force }}:</b> {{ level }}</li>
        {% else %}
            <li><i>No Porter's data available for this document. Upload a new document to generate this analysis.</i></li>
        {% endfor %}
    </ul>
</div>

{% endif %}
{% endblock %}